name: Setup CircuitPython Port Builder Composite Action
description: Port builder actions for CircuitPython steps
author: FoBE Studio
branding:
  icon: chevron-right
  color: purple

inputs:
  repo_remote:
    description: The CircuitPython repository remote ('origin', 'upstream')
    default: origin
    required: false
  repo_ref:
    description: The CircuitPython repository reference (branch, tag, commit)
    default: main
    required: false
  port:
    description: The CircuitPython platform to build (espressif, nordic)
    required: true
  board:
    description: The CircuitPython board to build
    default: ""
    required: false

runs:
  using: composite
  steps:
    - id: build_circuitpython
      run: |
        sudo rm -rf $GITHUB_WORKSPACE/bin
        sudo mkdir -p $GITHUB_WORKSPACE/bin
        docker run --rm \
          --env GITHUB_ACTIONS \
          --env REPO_REMOTE \
          --env REPO_REF \
          --env BOARD \
          -v $GITHUB_WORKSPACE/bin:/workspace/bin \
          ghcr.io/fobe-projects/action-circuitpython-builder:main-${{ inputs.port }}
      shell: bash
      env:
        REPO_REMOTE: ${{ inputs.repo_remote }}
        REPO_REF: ${{ inputs.repo_ref }}
        BOARD: ${{ inputs.board }}